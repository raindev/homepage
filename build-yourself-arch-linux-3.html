<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Build Yourself Arch Linux, Part 3 - raindev</title>
        <link rel="stylesheet" type="text/css" href="./css/default.css" />
        <link rel="stylesheet" type"text css" href="./css/gh-fork-ribbon.css" />
        <link rel="alternate" type="application/atom+xml" href="./atom.xml" title="Atom feed of raindev's blog">
        <link rel="alternate" type="application/rss+xml" href="./rss.xml" title="RSS feed of raindev's blog">

        <!-- Google Analytics -->
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-38075720-2', 'auto');
            ga('send', 'pageview');

        </script>
    </head>
    <body>
         <a class="github-fork-ribbon" href="https://github.com/raindev" title="Fork me on GitHub">Fork me on GitHub</a>
        <div id="header">
            <div id="logo">
                <a href="./">Thoughts and Opinions</a>
            </div>
            <div id="navigation">
                <a href="./">Home</a>
                <a href="./about.html">About</a>
                <a href="./contact.html">Contact</a>
                <a href="./archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>Build Yourself Arch Linux, Part 3</h1>

            <div class="info">
    Posted on June 25, 2017
</div>

<h1 id="part-3-lets-get-a-gui">Part 3: Let’s Get a GUI</h1>
<p>This is the third and final part of Build Yourself Arch Linux guide. This part will be mostly about choices I’ve made and justifications behind them. I’ll try to keep it short this time ;) Also in this part I’ll finally get to GUI installation.</p>
<h2 id="gnome-shell">GNOME Shell</h2>
<p>Before settling down on <a href="https://gnome.org/">GNOME</a> I’ve tried (well installed and pondered around for 10 minutes) most of <a href="https://wiki.archlinux.org/index.php/Desktop_environment#List_of_desktop_environments">desktop environments supported by Arch</a>. I’ve been using GNOME 3 in the past but decided to look what else is out there. The reason I’ve settled on GNOME is HiDPI support. While there’re other desktop environments that support HiDPI GNOME gave me the best result with pretty much no configuration. I was really tempted by <a href="https://www.kde.org/plasma-desktop">KDE Plasma</a> which looks gorgeous and does support HiDPI. Still on MacBook’s screen GNOME was a bit more consistent: I’ve got too small icons here and there in Plasma. <a href="http://lxqt.org/">LXQT</a> is another DE I’m interested in. Given the progress towards HiDPI support or possibility of getting an external monitor with ordinary resolution I’ll probably be able to reevaluate my choice of desktop environment soon enough.</p>
<h3 id="installation">Installation</h3>
<p>Installation of GNOME was quite an easy task: I went for “minimal” <code>gnome-shell</code> package which is around 750 MB of depenencies in total (instead of around 1500 MB for <code>gnome</code> and 2030 MB for <code>gnome-extra</code>). As I was going to use <a href="https://wiki.archlinux.org/index.php/Wayland">Wayland</a>, I had to get <a href="https://wayland.freedesktop.org/xserver.html">XWayland</a> separately: <code>xorg-server-xwayland</code> package which wasn’t pulled in as a dependency that led to <code>gnome-shell[600]: Failed to spawn Xwayland: Failed to execute child process &quot;/usr/bin/Xwayland&quot; (No such file or directory)</code> when starting GNOME.</p>
<h3 id="startup">Startup</h3>
<p>Because I still do some stuff in console, I have created a tiny script to easily start GNOME under Wayland manually as described on <a href="https://wiki.archlinux.org/index.php/GNOME#Wayland_sessions">ArchWiki</a>. I’ve tried to use <a href="https://wiki.archlinux.org/index.php/GDM">GDM</a> first but it didn’t make much sense given my setup. E.g. it doesn’t make sense to type both disk encryption password and user’s password to boot and if I’m not going to select different users/sessions why have a display manager in the first place? When starting GNOME I see couple of error messages <code>Activated service 'org.freedesktop.systemd1' failed: Process org.freedesktop.systemd1 exited with status 1</code> that doesn’t seem to be critical, you can find a related discussion on <a href="https://github.com/systemd/systemd/issues/5247">GitHub</a>.</p>
<h3 id="disable-cursor-blinking">Disable cursor blinking</h3>
<p>As you might already know from the previous part of the guide I don’t particularly ejoy cursor flickering. Fortunately it is possible to disable it system-wide for GUI applications in GNOME: <code>gsettings set org.gnome.desktop.interface cursor-blink true</code>.</p>
<h3 id="more-gnome-apps">More GNOME apps</h3>
<p>After getting GNOME working I’ve installed <code>gnome-controll-center</code> which gives access to graphical preferences. The package asks you to select on of <code>libx264</code> and <code>libx264-10bit</code> dependencies, see <a href="https://www.reddit.com/r/archlinux/comments/30khba/libx264_vs_libx26410bit/">the Reddit post</a> why you probably want non 10bit version. To be able to change desktop backgrounds I’ve also grabbed <code>gnome-backgrounds</code> package.</p>
<p>For a graphical file manager I’ve installed the default <code>nautilus</code> plus <code>sushi</code> which gives previes of selected files I used to have from macOS. Some other GNOME packages I have installed: <code>gnome-documents</code> - to read books (e.g. in epub); <code>gnome-calculator</code> - gives ability to use GNOME Overview search as calculator as well; <code>gnome-dictionary</code> to look up definitions, analogue of macOS built-in dictionary; <code>gnome-keyring</code> system-wide secret storage; <code>gnome-screenshot</code> a really great tool for taking screenshots; <code>tracker</code> - to search for files from the Overview; <code>gnome-clocks</code> and <code>gnome-weather</code> to get multiple clocks and a forecast in the calendar dropdown respectively; <code>gnome-maps</code> - a pretty good OpenStreetMap based application; <code>gnome-tweak-tool</code> - to have access to more detailed graphical configuration.</p>
<h3 id="extensions">Extensions</h3>
<p><code>gnome-shell-extensions</code> is a bundle of default GNOME extensions from which I use WindowsNavigator to switch between windows in Overview using a keyboard. See <a href="https://wiki.archlinux.org/index.php/Gnome#Extensions">the ArchWiki</a> on details how to enable exension managemeng using https://extensions.gnome.org/.</p>
<h3 id="hide-unwanted-desktop-icons">Hide unwanted desktop icons</h3>
<p>Tip: to get rid of icons of applications installed as dependencies that you do not use <code>NoDisplay=True</code> in .desktop file. Copy the desktop file to <code>~/.local/share/applications</code> to not have it overwritten by every application update.</p>
<h3 id="not-a-perfect-story">Not a perfect story</h3>
<p>One thing I don’t like about GNOME so much is that it’s very monolithic. It expects you to install full suite of applications along with Gnome Shell itself (given number of error messages in logs related to not found <a href="https://wiki.archlinux.org/index.php/D-Bus">DBus</a> services for GNOME applications I’ve opted to not install. On one hand if you install only the shell you’ll end up with non functional GUI elements (desktop backgound selection, settings button), on the other hand if you install <code>gnome-controll-center</code> Cheese webcam application gets pulled in (which is fine as I use it to test my webcam before calls but annoying nevertheless).</p>
<h2 id="workman-layout">Workman layout</h2>
<p>I can’t do on a computer much at all without a Workman keyboard layout. Fortunately it was installed already as part of <code>xkeyboard-config</code>, pulled in by GNOME. The only thing I had to do it to remap Caps Lock to Control which means editing <code>workman</code> section in <code>/usr/share/X11/xkb/symbols/us</code> and replacing <code>key &lt;CAPS&gt;</code> mapping with <code>{ [ Control_L ] };</code> (there’s probably a better way to <em>override</em> the keymap configuration instead to prevent the modification from being erased by an upgrade of the package).</p>
<h2 id="terminal-emulator">Terminal emulator</h2>
<p><a href="https://gnunn1.github.io/tilix-web/">Tilix</a> is a more future reach alternative to GNOME Terminal and a quite close rival to macOS’ iTerm. It’s quite young project there’s no Tilix package in the official repositories yet. Building AUR package works well, except you’ll have to recompile Tilix when its dependency <code>gtkd</code> is updated otherwise it will fail to launch. I’ve enabled “Run command as a login shell” in Tilix profile configuration configuration (section Command) to enable shell integration (like opening new tabs keeping the same working directory.</p>
<p>Not tied to specific terminal emulator, but to make shell more pleasant to use I’ve installed <code>bash-completion</code>.</p>
<h2 id="building-packages">Building packages</h2>
<p><code>xz</code> utility is used to get smaller package size at expense of build time. When installing AUR packages compression takes a significant time. To reduce compression time you can compress packages using multiple threads as described <a href="https://wiki.archlinux.org/index.php/Makepkg#Utilizing_multiple_cores_on_compression">here</a>. The same way you can speed up building AUR packages by using multiple threads by having <code>MAKEFLAGS=&quot;-j$(nproc)&quot;</code> in <code>/etc/makepkg.conf</code>.</p>
<p>You can also build (slightly) faster binaries when compiling from source by sacrificing portability which doesn’t matter if you run buit packages only on your own machine. You can use all the instruction set of your CPU by having <code>-mnative</code> in the compiler flags (<code>CFLAGS</code> and <code>CXXFLAGS</code> in <code>/etc/makepkg.conf</code>).</p>
<p>Why you probably wouldn’t build packages from source frequently except from AUR the configuration above applies to any packages built with makepkg.</p>
<p>Build faster packages - -march=native for CFLAGS and CXXFLAGS</p>
<h2 id="browser">Browser</h2>
<p>Not much to say here really. Firefox works great on Linux and with the recent improvements to speed and stability in versions 55-57 I’ve got no reasons to look elsewhere.</p>
<h2 id="webcam">Webcam</h2>
<p>Even though there’re no stable driver for the Macbook’s webcam there’s a successfull ongoing effort to provide one. To get the camera working <code>bcwc-pcie-git</code> from AUR is enough. I also have got <code>cheese</code> primarily to test the camera lighting before calls.</p>
<h2 id="graphics-drivers">Graphics Drivers</h2>
<p>Fortunately I’ve got only integrated Intel GPU which has very good Linux support. Following <a href="https://wiki.archlinux.org/index.php/Intel_graphics#Installation">the ArchWiki article</a> I’ve installed xf86-video-intel to get 2D hardware acceleration and vulkan-intel to have <a href="https://wiki.archlinux.org/index.php/Vulkan">Vulkan API</a> support; mesa for 3D accelecration was pulled in by GNOME already. There’re two <a href="https://wiki.archlinux.org/index.php/Hardware_video_acceleration">APIs for video hardware acceleration</a> on Linux: VA-API and VDPAU developed by Intel and Nvidia respectively. To enable VA-API I’ve installed libva-intel-driver and to verify that it’s indeed available <code>vainfo</code> from libva-utils (available from AUR). I didn’t get VDPAU to work under Wayland (even though it worked out of the box with an Xorg session). This is not critical in my case since my video player of choice <a href="#mpv">mpv</a> supports VA-API. To avoid screen flickering multiple times during the boot I’ve enabled early loading of i915 kernel module (Intel graphics) as described <a href="https://wiki.archlinux.org/index.php/Kernel_mode_setting#Early_KMS_start">here</a>. The downside is the high brightness during early boot until disk password is entered.</p>
<h2 id="touchpad">Touchpad</h2>
<p>At first I’ve tried xf86-input-mtrack touchpad driver to get belowed 3 finger drag that I used to on macOS so much. The driver is Xorg only meaning I won’t be able to keep it going Wayland. I’ve did some research and basically the gesture is not coming to Wayland anytime soon (see <a href="https://www.reddit.com/r/archlinux/comments/6c64jr/3_finger_drag_for_wayland/">my reddit post</a>). After some frustration I’ve gave up on the idea, decided to unlearn the gesture and stuck with Wayland.</p>
<p>The only tweaking I did in the result was to enable tap to click and increase touchpad speed via GNOME Settings.</p>
<h2 id="spotify">Spotify</h2>
<p>Spotify is available from AUR and is updated pretty frequently. HiDPI support needs to be enabled manually however, consult <a href="https://wiki.archlinux.org/HiDPI#Spotify">ArchWiki</a> on the details.</p>
<h2 id="text-editor">Text editor</h2>
<p>I’ve replaced vim with gvim (one of the reasons being vim is compiled without +clipboard, meaning no clipboard access). Of course command line vim binary is included in the package as well. Because gVim’s icon looks ugly on high resolution displays I’ve replaced it with the one from <a href="http://vimr.org">VimR project</a>. To do it replace <code>Icon</code> value in gVim’s .desktop file with the path to the new image (copy desktop file first to prevent overwrites as mentioned <a href="gnome">above</a>.</p>
<h2 id="caveats">Caveats</h2>
<p>Sometimes there’s red light bcoming from audio jack (no, really!). First it looked like the issues went away after installing TLP but I still see it time to time. Later on I discovered that it’s related to sound output mode: when I switch from built-in speakers to S/PDF in Settings. It keeps lighting for some time after switching back to the internal speakers however.</p>

        </div>
        <div id="footer">
            <div id="license">
              <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
                <img alt="Creative Commons License" src="./images/by-nc-sa.svg" title="The content is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License" />
              </a>
            </div>
            <div>
                You could subscribe for the updates using
                <a href="./atom.xml">Atom</a>
                or
                <a href="./rss.xml">RSS</a>
                feed
            </div>
            <div>
                Proudly generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a>.
                The website theme is inspired by
                <a href="http://bettermotherfuckingwebsite.com">this website</a>
            </div>
            <div>
                Credit for the portrait goes to <a href="https://instagram.com/ann_holovach">Hanna Holovach</a>
            </div>
        </div>
    </body>
</html>
